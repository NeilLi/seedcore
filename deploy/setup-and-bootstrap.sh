#!/usr/bin/env bash
set -euo pipefail

# Combined setup script that runs:
# 1. setup-ray-serve.sh
# 2. bootstrap_organism.sh
# 3. bootstrap_dispatchers.sh

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "═══════════════════════════════════════════════════════════════"
echo "🚀 Starting full setup: Ray Serve → Bootstrap Organism → Bootstrap Dispatchers"
echo "═══════════════════════════════════════════════════════════════"
echo

# Step 1: Setup Ray Serve
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📍 Step 1/3: Setting up Ray Serve"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
cd "$SCRIPT_DIR"
bash "${SCRIPT_DIR}/setup-ray-serve.sh" "$@"
echo

# Step 2: Bootstrap Organism
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📍 Step 2/3: Bootstrapping Organism"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
cd "$SCRIPT_DIR"
bash "${SCRIPT_DIR}/bootstrap_organism.sh"
echo

# Step 3: Bootstrap Dispatchers
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📍 Step 3/3: Bootstrapping Dispatchers"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
cd "$SCRIPT_DIR"
bash "${SCRIPT_DIR}/bootstrap_dispatchers.sh"
echo

echo "═══════════════════════════════════════════════════════════════"
echo "✅ All setup steps completed successfully!"
echo "═══════════════════════════════════════════════════════════════"
