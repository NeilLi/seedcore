# SeedCore v2.5+ VLA (Vision-Language-Action) Configuration
# -----------------------------------------------------------
# Defines the organs for 2026's VLA workflows with Brain-Foundry and Physical-Actuation.
# Each organ represents an autonomous subsystem composed of specialized agent clusters.

seedcore:
  organism:
    # --- Returned as 'global_settings' ---
    settings:
      tunnel_threshold: 0.85
      tunnel_intents: ["clarify", "debug"]

    organs:
      # =============================================================
      #  CORE GENERAL ORGANS
      # =============================================================
      # Note: Additional agents are dynamically spawned from pkg_subtask_types
      # via CapabilityMonitor. Static config here is for baseline initialization only.
      
      - id: "user_experience_organ"
        description: "User dialog and interaction."
        agents:
          - specialization: "USER_LIAISON"
            class: "BaseAgent"
            behaviors: ["chat_history", "tool_auto_injection"]
            behavior_config:
              chat_history:
                limit: 50
              tool_auto_injection:
                auto_add_general_query: true
            count: 1

      - id: "utility_organ"
        description: "Utility and generalist agents."
        agents:
          - specialization: "GENERALIST"
            class: "BaseAgent"
            behaviors: ["background_loop"]
            behavior_config:
              background_loop:
                interval_s: 0.2
                method: "proprioception_sync"
            count: 1

      # =============================================================
      #  VLA WORKFLOW ORGANS (SeedCore v2.5+)
      # =============================================================

      - id: "brain_foundry_organ"
        description: "Discovery & Distillation pipeline for VLA models. Manages 'mental' models without physical actuation."
        agents:
          # Agent 1: Discovery Agent - Programmatic scanning of Hugging Face
          - specialization: "hf_scanner"
            class: "BaseAgent"
            behaviors: ["background_loop", "task_filter"]
            behavior_config:
              background_loop:
                interval_s: 30.0
                method: "model_indexing_scan"
                max_errors: 3
              task_filter:
                allowed_types: ["model_discovery", "hf_scan", "vla_search"]
            # RoleProfile should define:
            #   default_skills: {model_indexing: 1.0, metadata_parsing: 0.8}
            #   allowed_tools: ["hf_hub.list_models", "lerobot.registry.query"]
            #   routing_tags: ["hf_scan", "vla_search", "brain_foundry"]
            count: 1

          # Agent 2: Teacher/Student Agent - Trace-Replay distillation
          - specialization: "distill_expert"
            class: "BaseAgent"
            behaviors: ["background_loop", "task_filter"]
            behavior_config:
              background_loop:
                interval_s: 60.0
                method: "distillation_monitor"
                max_errors: 5
              task_filter:
                allowed_types: ["distillation_replay", "synthetic_data_gen", "lora_tuning"]
            # RoleProfile should define:
            #   default_skills: {synthetic_data_gen: 0.9, lora_tuning: 0.9}
            #   allowed_tools: ["finetune.run_lerobot", "teacher.escalate_gpt4"]
            #   routing_tags: ["distillation", "brain_foundry", "vla"]
            count: 1

      - id: "physical_actuation_organ"
        description: "Physical-Actuation Organ (Reachy Core). Maps SeedCore commands to Reachy Mini daemon for real-time motor and sensory control. Includes 2026 safety guard and sim-to-real validation."
        agents:
          # NOTE: reachy_actuator agent is dynamically spawned from pkg_subtask_types via CapabilityMonitor.
          # Do NOT pre-spawn here to avoid race condition where agent is created before specialization is registered.
          # The agent will be JIT-spawned on-demand when the first task arrives, ensuring correct specialization.
          
          # Agent 4: Safety Guard Agent (2026 Best Practice) - Static spawn OK (not hardware-specific)
          - specialization: "safety_guard"
            class: "BaseAgent"
            behaviors: ["background_loop", "task_filter", "safety_check"]
            behavior_config:
              background_loop:
                interval_s: 0.1  # High-frequency safety monitoring
                method: "safety_monitor"
                max_errors: 1  # Fail-safe: any error triggers alert
              task_filter:
                allowed_types: ["safety.validate", "safety.estop", "safety.red_team"]
              safety_check:
                enabled: true
                guardrail_enabled: true
                guardrail_model: "meta-llama/Llama-Guard-3-Robot"
                risk_threshold: 0.7  # More conservative than actuator
                joint_limit_check: true
                safety_level_estop: 0.9  # E-STOP threshold
            count: 1

    # =============================================================
    #  2. FUNCTIONAL LAYER — VIRTUAL NETWORK OVERLAY (ENERGY BONDS)
    # =============================================================

    topology:
      # Minimal topology configuration
      # Additional bonds are dynamically discovered from agent interactions
      
      # Cross-Organ Integration Bonds
      cross_organ_bonds:
        - agents: ["USER_LIAISON", "GENERALIST"]
          weight: 0.7
          description: "User → generalist coordination loop"
        - agents: ["GENERALIST", "reachy_actuator"]
          weight: 0.8
          description: "Generalist → physical actuation handoff"
        - agents: ["hf_scanner", "distill_expert"]
          weight: 0.75
          description: "Discovery → distillation pipeline"
        - agents: ["distill_expert", "reachy_actuator"]
          weight: 0.7
          description: "Distillation → execution bridge"
        
        # 2026 Safety & Sim-to-Real Bonds
        - agents: ["reachy_actuator", "safety_guard"]
          weight: 0.95
          description: "Actuator → Safety Guard (Red-Teaming bond, 2026 best practice)"
        - agents: ["reachy_actuator", "isaac.gym"]
          weight: 0.85
          description: "Actuator → Sim-to-Real Validation (NVIDIA GR00T 1.6 integration)"
        - agents: ["safety_guard", "GENERALIST"]
          weight: 0.75
          description: "Safety Guard → Generalist (E-STOP coordination)"

      # Global defaults
      defaults:
        min_weight_threshold: 0.1
        symmetry: true
        max_partners: 4
        seed_missing_agents: true
